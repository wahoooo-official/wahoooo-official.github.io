<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<link rel="icon" type="image/png" href="favicon/favicon.png">

<style>
/* RESET TOTALE */
html, body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
}

/* BLOCCO DI SICUREZZA */
body{
  overflow-x:hidden;
  background:#000; /* non dovrebbe MAI vedersi */
  font-family: Trebuchet MS, sans-serif;
}

/* APP WRAPPER (ANTI SVG) */
.app{
  position:relative;
  min-height:100vh;
  width:100%;
  background:#e6e6e6;
  z-index:9999;
}

/* HEADER */
header{
  background:#ff9f00;
  color:#fff;
  text-align:center;
  padding:25px;
  font-size:26px;
  font-weight:bold;
  position:sticky;
  top:0;
  z-index:100;
}

.hidden{display:none}

/* LOGIN */
.box{
  max-width:420px;
  margin:80px auto;
  background:#fff;
  padding:30px;
  border-radius:14px;
  text-align:center;
  box-shadow:0 0 15px rgba(0,0,0,.2);
}

input,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}

button{
  background:#ff9f00;
  color:white;
  font-weight:bold;
  border:none;
  cursor:pointer;
}
button:hover{background:#e08600}

/* MENU */
.menu{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:20px;
  flex-wrap:wrap;
}

.container{
  max-width:1100px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 15px rgba(0,0,0,.2);
}

/* SEZIONI */
.section{display:none}
.section.active{display:block}

/* FOGLI */
iframe{
  width:100%;
  height:600px;
  border:none;
  border-radius:10px;
}

/* CHAT */
.chat-box{
  height:300px;
  overflow-y:auto;
  background:#f9f9f9;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
}

.msg{
  font-size:14px;
  margin-bottom:6px;
}
.msg strong{color:#ff9f00}

.chat-input{
  display:flex;
  gap:6px;
  margin-top:10px;
}

/* CHAT FLOAT */
#chat-float{
  position:fixed;
  bottom:20px;
  right:20px;
  width:320px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 0 15px rgba(0,0,0,.3);
  display:none;
  flex-direction:column;
  z-index:200;
}

#chat-header{
  background:#ff9f00;
  color:white;
  padding:10px;
  font-weight:bold;
  cursor:pointer;
  border-radius:14px 14px 0 0;
}
</style>
</head>

<body>

<div class="app">

<header>ðŸ‘‘ Admin Panel</header>

<!-- LOGIN -->
<div id="loginBox" class="box hidden">
  <h2>Accedi / Registrati</h2>
  <input id="name" placeholder="Nome">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="loginOrRegister()">Accedi / Registrati</button>
</div>

<!-- ADMIN -->
<div id="adminPanel" class="hidden">
  <div class="menu">
    <button onclick="show('fogli')">ðŸ“Š Fogli</button>
    <button onclick="show('chat')">ðŸ’¬ Chat</button>
    <button onclick="toggleChat()">ðŸŸ¢ Chat flottante</button>
    <button onclick="logout()">ðŸšª Esci</button>
  </div>

  <div class="container">
    <div id="fogli" class="section active">
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSGKiHRceif9TPzCotNJU-Gt8-gWDn9PoyBiWOplfjbtMXkayJ6hErOSpZJ9YWRMhipLZXS5LXEuZs0/pubhtml"></iframe>
    </div>

    <div id="chat" class="section">
      <div id="chatMain" class="chat-box"></div>
      <div class="chat-input">
        <input id="msgMain" placeholder="Messaggio">
        <button onclick="send()">â–¶</button>
      </div>
    </div>
  </div>
</div>

</div>

<!-- CHAT FLOAT -->
<div id="chat-float">
  <div id="chat-header" onclick="toggleChat()">ðŸ’¬ Chat</div>
  <div id="chatFloat" class="chat-box"></div>
  <div class="chat-input">
    <input id="msgFloat" placeholder="Messaggio">
    <button onclick="send()">â–¶</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBHNaMmfMGm-7JQLLagfImQ9L_itv7MBXg",
  authDomain: "wahoooo-adminpannel.firebaseapp.com",
  projectId: "wahoooo-adminpannel",
  storageBucket: "wahoooo-adminpannel.firebasestorage.app",
  messagingSenderId: "720468566572",
  appId: "1:720468566572:web:3c00c076571050d45ce789"
});

const auth = getAuth(app);
const db = getFirestore(app);

let nameUser="Utente", uid=null;

window.loginOrRegister=async()=>{
  try{await signInWithEmailAndPassword(auth,email.value,password.value);}
  catch{await createUserWithEmailAndPassword(auth,email.value,password.value);}
};

onAuthStateChanged(auth, async u=>{
  if(!u){loginBox.classList.remove("hidden");adminPanel.classList.add("hidden");return;}
  uid=u.uid;
  const r=doc(db,"users",uid), s=await getDoc(r);
  if(!s.exists()){nameUser=name.value||"Utente";await setDoc(r,{name:nameUser});}
  else nameUser=s.data().name;
  loginBox.classList.add("hidden");adminPanel.classList.remove("hidden");
});

window.show=id=>{
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};
window.toggleChat=()=>chatFloat.style.display=chatFloat.style.display==="flex"?"none":"flex";
window.logout=async()=>{await signOut(auth);location.reload();}
</script>

</body>
</html>
